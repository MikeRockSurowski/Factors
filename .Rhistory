y = RDA2,
label = label),
colour = 'black',
vjust = -1,
hjust = 0.5,
cex = 3.5)
biplot.paas.ratios <- baseplot.paas.ratios +
# draw sample points
geom_point(data = sample.scores.paas.ratios,
aes(x = RDA1,
y = RDA2,
color = thickness,
shape = skeletPart),
size = 1.5) +
labs(title = "Spots distribution in RDA space (model-4)",
x = "RDA-1 (80.07%)",
y = "RDA-2 (13.17%)")
biplot.paas.ratios.zoom <- baseplot.paas.ratios +
# names of the elements
geom_text(data = element.scores.paas.ratios,
aes(x = RDA1,
y = RDA2,
label = Element),
vjust = 1,
hjust = 1,
color = "darkred",
cex = 3,
fontface='bold') +
xlim(-1.2, 1.2) +
#
# ylim(-1.05, 1.05) +
# style
labs(title = "PAAS-normalized ratios loadings (model-4)",
x = "RDA-1 (80.07%)",
y = "RDA-2 (13.17%)")
ggsave('Plots and figures/RDA biplots/RDA PAAS ratios biplot.png',
plot = biplot.paas.ratios,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
ggsave('Plots and figures/RDA biplots/RDA PAAS ratios biplot ZOOM.png',
plot = biplot.paas.ratios.zoom,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
library(writexl)
library(openxlsx)
library(readxl)
library(tidyr)
library(dplyr)
library(data.table)
library(reshape2)
library(stringr)
library(gridExtra)
library(ggplot2)
library(pcaPP)
library(compositions)
library(vegan)
library(dunn.test)
library(MVN)
ppmData <- read.csv('Data/ppm_sing_profiles_3mm.csv', sep=';')
paasData <- read.csv('Data/paas_sing_profiles_3mm.csv', sep=';')
yData <- read.csv('Data/spots_sing_profiles_3mm.csv', sep=';')
dataIDs <- subset(ppmData, select=c(SampleID, Line, Spot, SpotID))
dataIDs$ProfileID <- paste(dataIDs$SampleID, dataIDs$Line, sep = '-')
data.PAAS <- subset(paasData, select=-c(SampleID, Line, Spot, SpotID))
data.ppm <- subset(ppmData, select=-c(SampleID, Line, Spot, SpotID))
data.ppm[is.na(data.ppm)] <- 0.0001
traces.ppm <- data.ppm[, -1]
clr.data <- clr(acomp(data.ppm, detectionlimit=0.0001))
clr.traces.data <- clr(acomp(traces.ppm, detectionlimit=0.0001))
data.locality <- factor(yData$Locality, levels = c('Bayan Dzak', 'Altan Uul', 'Nemegt', 'Tsagan Khushuu'))
data.skeletal.part <- factor(yData$skeletPart, levels = c('humerus', 'femur', 'tibia', 'metatarsal', 'rib', 'radius'))
data.cortical.thickness <- factor(yData$thickClass, levels = c('mid', 'short', 'long'))
data.mm.dist <- yData$mmDist
data.sample.ID <- factor(yData$SampleID)
data.profile.ID <- factor(dataIDs$ProfileID)
# main datasets
clr.data.scaled <- scale(clr.data)
clr.traces.scaled <- scale(clr.traces.data)
rda.all.variables <- rda(clr.data.scaled ~ data.cortical.thickness + data.skeletal.part + data.locality + Condition(data.mm.dist))
rda.all.variables.sign.axes <- anova(rda.all.variables, by='axis')
rda.all.variables.sign.trms <- anova(rda.all.variables, by='terms')
rda.all.variables.sign.marg <- anova(rda.all.variables, by='margin')
rda.all.variables.sign.1dgf <- anova(rda.all.variables, by='onedf')
sample.scores.all <- as.data.frame(scores(rda.all.variables, display='sites'))
element.scores.all <- as.data.frame(scores(rda.all.variables, display='species'))
arrow.scores.all <- as.data.frame(scores(rda.all.variables, display='bp'))
element.scores.all$RDA.abs.sum <- abs(element.scores.all$RDA1) + abs(element.scores.all$RDA2)
element.scores.all$Element <- rownames(element.scores.all)
sample.scores.all$thickness <- data.cortical.thickness
sample.scores.all$skeletPart <- data.skeletal.part
sample.scores.all$locality <- data.locality
arrow.scores.all$label <- c(
'short',
'long',
'femur',
'tibia',
'metatarsal',
'rib',
'radius',
'Altan Uul',
'Nemegt',
'Tsagan Khushuu'
)
arrow.scores.all$Variable <- c(
'cortical thickness',
'cortical thickness',
'skeletal part',
'skeletal part',
'skeletal part',
'skeletal part',
'skeletal part',
'locality',
'locality',
'locality'
)
arrow.scores.all$weighted.length <- sqrt( (arrow.scores.all$RDA1**2 * 0.6738) +
(arrow.scores.all$RDA2**2 * 0.1504) )
baseplot.all.variables.comp <- ggplot(data=arrow.scores.all) +
# style
theme_minimal() +
theme(axis.line.x = element_line(color="black",
linewidth = 0.8),
axis.line.y = element_line(color="black",
linewidth = 0.8),
legend.position = "none") +
geom_hline(yintercept = 0, color = "black", linewidth = .5) +
geom_vline(xintercept = 0, color = "black", linewidth = .5) +
# draw arrows of the explanatory variables
geom_segment(data = arrow.scores.all,
aes(x = 0,
y = 0,
xend = RDA1,
yend = RDA2,
colour = Variable),
arrow = arrow(length = unit(0.2,
"cm"),
angle = 15,
type='closed'),
inherit.aes = FALSE) +
# describe the explanatory variables
geom_text(data = arrow.scores.all,
aes(x = RDA1,
y = RDA2,
label = label),
colour = 'black',
vjust = -1,
hjust = 0.5,
cex = 3.5,
inherit.aes = FALSE)
biplot.all.variables.comp <- baseplot.all.variables.comp +
# draw sample points
geom_point(data = sample.scores.all,
aes(x = RDA1,
y = RDA2,
color = locality,
shape = skeletPart),
size = 3) +
labs(title = "Spots distribution in RDA space (model-1)",
x = "RDA1",
y = "RDA2") +
facet_wrap(~thickness,
ncol = 3)
biplot.all.variables.comp.zoom <- baseplot.all.variables.comp +
# names of the elements
geom_text(data = element.scores.all,
aes(x = RDA1,
y = RDA2,
label = Element),
vjust = 1,
hjust = 1,
color = "darkred",
cex = 3,
fontface='bold') +
labs(title = "Element loadings (model-1)",
x = "RDA-1 (67.38%)",
y = "RDA-2 (15.04%)")
ggsave('Plots and figures/RDA biplots/RDA biplot - all.variables.png',
plot = biplot.all.variables.comp,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
ggsave('Plots and figures/RDA biplots/RDA biplot - all.variables ZOOM.png',
plot = biplot.all.variables.comp.zoom,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
rda.locality <- rda(clr.data.scaled ~ data.locality + Condition(data.cortical.thickness +
data.skeletal.part +
data.mm.dist))
rda.locality.sign.axes <- anova(rda.locality, by='axis')
rda.locality.sign.trms <- anova(rda.locality, by='terms')
rda.locality.sign.marg <- anova(rda.locality, by='margin')
rda.locality.sign.1dgf <- anova(rda.locality, by='onedf')
sample.scores.locality <- as.data.frame(scores(rda.locality, display='sites'))
element.scores.locality <- as.data.frame(scores(rda.locality, display='species'))
arrow.scores.locality <- as.data.frame(scores(rda.locality, display='bp'))
sample.scores.locality$thickness <- data.cortical.thickness
sample.scores.locality$skeletPart <- data.skeletal.part
sample.scores.locality$locality <- data.locality
element.scores.locality$RDA.abs.sum <- abs(element.scores.locality$RDA1) + abs(element.scores.locality$RDA2)
element.scores.locality$Element <- rownames(element.scores.locality)
arrow.scores.locality$Locality <- c('Altan Uul',
'Nemegt',
'Tsagan Khushuu')
arrow.scores.locality$weighted.length <- sqrt( (arrow.scores.locality$RDA1**2 * 0.744) +
(arrow.scores.locality$RDA2**2 * 0.1876) )
baseplot.locality <- ggplot() +
# style
theme_minimal() +
theme(axis.line.x = element_line(color="black",
linewidth = 0.8),
axis.line.y = element_line(color="black",
linewidth = 0.8),
legend.position = "none") +
geom_hline(yintercept = 0, color = "black", linewidth = .5) +
geom_vline(xintercept = 0, color = "black", linewidth = .5) +
# draw arrows of the explanatory variables
geom_segment(data = arrow.scores.locality,
aes(x = 0,
y = 0,
xend = RDA1,
yend = RDA2,
colour = Locality),
arrow = arrow(length = unit(0.2, "cm"),
angle = 15,
type='closed')) +
# describe the explanatory variables
geom_text(data = arrow.scores.locality,
aes(x = RDA1,
y = RDA2,
label = Locality),
colour = 'black',
vjust = -1,
hjust = 0.5,
cex = 3.5)
biplot.locality <- baseplot.locality +
# draw sample points
geom_point(data = sample.scores.locality,
aes(x = RDA1,
y = RDA2,
color = locality),
size = 1.5) +
geom_point(shape = 1, size=1.5, colour = 'black') +
# style
labs(title = "Spots distribution in RDA space (model-2)",
x = "RDA-1 (74.4%)",
y = "RDA-2 (18.76%)")
biplot.locality.zoom <- baseplot.locality +
# names of the elements
geom_text(data = element.scores.locality,
aes(x = RDA1,
y = RDA2,
label = Element),
vjust = 1,
hjust = 1,
color = "darkred",
cex = 3,
fontface='bold') +
# style
labs(title = "Element loadings (model-2)",
x = "RDA-1 (74.40%)",
y = "RDA-2 (18.76%)")
ggsave('Plots and figures/RDA biplots/RDA biplot - full - only locality and conditions.png',
plot = biplot.locality,
bg = 'white',
dpi = 300,
width = 24,
height = 16,
units='cm')
ggsave('Plots and figures/RDA biplots/RDA biplot - full - only locality and conditions ZOOM.png',
plot = biplot.locality.zoom,
bg = 'white',
dpi = 300,
width = 24,
height = 16,
units='cm')
rda.corth.skp <- rda(clr.data.scaled ~ data.cortical.thickness + data.skeletal.part + Condition(data.locality + data.mm.dist))
rda.corth.skp.sign.axes <- anova(rda.corth.skp, by='axis')
rda.corth.skp.sign.trms <- anova(rda.corth.skp, by='terms')
rda.corth.skp.sign.marg <- anova(rda.corth.skp, by='margin')
rda.corth.skp.sign.1dgf <- anova(rda.corth.skp, by='onedf')
sample.scores.corth.skp <- as.data.frame(scores(rda.corth.skp, display='sites'))
element.scores.corth.skp <- as.data.frame(scores(rda.corth.skp, display='species'))
arrow.scores.corth.skp <- as.data.frame(scores(rda.corth.skp, display='bp'))
sample.scores.corth.skp$thickness <- factor(data.cortical.thickness,
levels = c('long', 'mid', 'short'))
sample.scores.corth.skp$skeletPart <- data.skeletal.part
sample.scores.corth.skp$locality <- data.locality
element.scores.corth.skp$RDA.abs.sum <- abs(element.scores.corth.skp$RDA1) + abs(element.scores.corth.skp$RDA2)
element.scores.corth.skp$Element <- rownames(element.scores.corth.skp)
arrow.scores.corth.skp$label <- c(
'short',
'long',
'femur',
'tibia',
'metatarsal',
'rib',
'radius'
)
arrow.scores.corth.skp$Variable <-  c(
'cortical thickness',
'cortical thickness',
'skeletal part',
'skeletal part',
'skeletal part',
'skeletal part',
'skeletal part')
arrow.scores.corth.skp$weighted.length <- sqrt( (arrow.scores.corth.skp$RDA1**2 * 0.6913) +
(arrow.scores.corth.skp$RDA2**2 * 0.1725) )
baseplot.corth.skp <- ggplot() +
# style
theme_minimal() +
theme(axis.line.x = element_line(color="black",
linewidth = 0.8),
axis.line.y = element_line(color="black",
linewidth = 0.8),
legend.position = "none") +
geom_hline(yintercept = 0, color = "black", linewidth = .5) +
geom_vline(xintercept = 0, color = "black", linewidth = .5) +
# draw arrows of the explanatory variables
geom_segment(data = arrow.scores.corth.skp,
aes(x = 0,
y = 0,
xend = RDA1,
yend = RDA2,
colour = Variable),
arrow = arrow(length = unit(0.2, "cm"),
angle = 15,
type='closed')
) +
# describe the explanatory variables
geom_text(data = arrow.scores.corth.skp,
aes(x = RDA1,
y = RDA2,
label = label),
colour = 'black',
vjust = -1,
hjust = 0.5,
cex = 3.5)
biplot.corth.skp <- baseplot.corth.skp +
# draw sample points
geom_point(data = sample.scores.corth.skp,
aes(x = RDA1,
y = RDA2,
color = thickness,
shape = skeletPart),
size = 1.5) +
labs(title = "Spots distribution in RDA space (model-3)",
x = "RDA-1 (69.13%)",
y = "RDA-2 (17.25%)")
biplot.corth.skp.zoom <- baseplot.corth.skp +
# names of the elements
geom_text(data = element.scores.corth.skp,
aes(x = RDA1,
y = RDA2,
label = Element),
vjust = 1,
hjust = 1,
color = "darkred",
cex = 3,
fontface='bold') +
# style
labs(title = "Element loadings (model-3)",
x = "RDA-1 (69.13%)",
y = "RDA-2 (17.25%)")
ggsave('Plots and figures/RDA biplots/RDA biplot - cond. locality.png',
plot = biplot.corth.skp,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
ggsave('Plots and figures/RDA biplots/RDA biplot - cond. locality ZOOM.png',
plot = biplot.corth.skp.zoom,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
paas.ratios <- data.frame(
LaN.SmN = data.PAAS$La / data.PAAS$Sm,
LaN.GdN = data.PAAS$La / data.PAAS$Gd,
NdN.YbN = data.PAAS$Nd / data.PAAS$Yb,
SmN.DyN = data.PAAS$Sm / data.PAAS$Dy,
Y.Ho = data.ppm$Y / data.ppm$Ho
)
noinf = rowSums(sapply(paas.ratios, is.infinite)) == 0
paas.ratios = paas.ratios[noinf, ]
ratios.cort.thickness = data.cortical.thickness[noinf]
ratios.skeletal.part = data.skeletal.part[noinf]
ratios.locality = data.locality[noinf]
ratios.mm.dist = data.mm.dist[noinf]
paas.ratios.logscaled <- scale(log(paas.ratios))
rda.paas.ratios <- rda(paas.ratios.logscaled ~ ratios.cort.thickness + ratios.skeletal.part + Condition(ratios.locality + ratios.mm.dist))
rda.paas.ratios.sign.axes <- anova(rda.paas.ratios, by='axis')
rda.paas.ratios.sign.trms <- anova(rda.paas.ratios, by='terms')
rda.paas.ratios.sign.marg <- anova(rda.paas.ratios, by='margin')
rda.paas.ratios.sign.1dgf <- anova(rda.paas.ratios, by='onedf')
sample.scores.paas.ratios <- as.data.frame(scores(rda.paas.ratios, display='sites'))
element.scores.paas.ratios <- as.data.frame(scores(rda.paas.ratios, display='species'))
arrow.scores.paas.ratios <- as.data.frame(scores(rda.paas.ratios, display='bp'))
sample.scores.paas.ratios$thickness <- ratios.cort.thickness
sample.scores.paas.ratios$skeletPart <- ratios.skeletal.part
sample.scores.paas.ratios$locality <- ratios.locality
element.scores.paas.ratios$RDA.abs.sum <- abs(element.scores.paas.ratios$RDA1) + abs(element.scores.paas.ratios$RDA2)
element.scores.paas.ratios$Element <- c(
'LaN/SmN',
'LaN/GdN',
'NdN/YbN',
'SmN/DyN',
'Y/Ho'
)
arrow.scores.paas.ratios$label <- c(
'short',
'long',
'femur',
'tibia',
'metatarsal',
'rib',
'radius'
)
arrow.scores.paas.ratios$Variable <-  c(
'cortical thickness',
'cortical thickness',
'skeletal part',
'skeletal part',
'skeletal part',
'skeletal part',
'skeletal part')
baseplot.paas.ratios <- ggplot() +
# style
theme_minimal() +
theme(axis.line.x = element_line(color="black",
linewidth = 0.8),
axis.line.y = element_line(color="black",
linewidth = 0.8),
legend.position="none") +
geom_hline(yintercept = 0, color = "black", linewidth = .5) +
geom_vline(xintercept = 0, color = "black", linewidth = .5) +
# draw arrows of the explanatory variables
geom_segment(data = arrow.scores.paas.ratios,
aes(x = 0,
y = 0,
xend = RDA1,
yend = RDA2,
colour = Variable),
arrow = arrow(length = unit(0.2, "cm"),
angle = 15,
type='closed')
) +
# describe the explanatory variables
geom_text(data = arrow.scores.paas.ratios,
aes(x = RDA1,
y = RDA2,
label = label),
colour = 'black',
vjust = -1,
hjust = 0.5,
cex = 3.5)
biplot.paas.ratios <- baseplot.paas.ratios +
# draw sample points
geom_point(data = sample.scores.paas.ratios,
aes(x = RDA1,
y = RDA2,
color = thickness,
shape = skeletPart),
size = 1.5) +
labs(title = "Spots distribution in RDA space (model-4)",
x = "RDA-1 (80.07%)",
y = "RDA-2 (13.17%)")
biplot.paas.ratios.zoom <- baseplot.paas.ratios +
# names of the elements
geom_text(data = element.scores.paas.ratios,
aes(x = RDA1,
y = RDA2,
label = Element),
vjust = 1,
hjust = 1,
color = "darkred",
cex = 3,
fontface='bold') +
xlim(-1.2, 1.2) +
#
# ylim(-1.05, 1.05) +
# style
labs(title = "PAAS-normalized ratios loadings (model-4)",
x = "RDA-1 (80.07%)",
y = "RDA-2 (13.17%)")
ggsave('Plots and figures/RDA biplots/RDA PAAS ratios biplot.png',
plot = biplot.paas.ratios,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
ggsave('Plots and figures/RDA biplots/RDA PAAS ratios biplot ZOOM.png',
plot = biplot.paas.ratios.zoom,
bg = 'white',
dpi = 300,
width = 25,
height = 15,
units='cm')
